# ุชูุฑูุฑ ุญุงูุฉ CSRF Middleware - HRMS Elite

## ๐ ููุฎุต ุงูุญุงูุฉ

โ **CSRF Middleware ููุทุจู ููููุนูู ุจูุฌุงุญ**

## ๐ง ุงูููููุงุช ุงูููุทุจูุฉ

### 1. CSRF Middleware ุงูุฃุณุงุณู
- **ุงูููู**: `server/index.ts`
- **ุงูุญุงูุฉ**: โ ููุทุจู
- **ุงูุชูููู**:
  ```typescript
  app.use(csrf({
    'cookie': {
      'httpOnly': true,
      'secure': process.env.NODE_ENV === 'production',
      'sameSite': 'strict',
      'maxAge': 24 * 60 * 60 * 1000 // 24 hours
    }
  }));
  ```

### 2. CSRF Middleware ุงููุชูุฏู
- **ุงูููู**: `server/middleware/csrf.ts`
- **ุงูุญุงูุฉ**: โ ููุทุจู
- **ุงูููููุงุช**:
  - `csrfTokenMiddleware`: ุฅุถุงูุฉ CSRF token ููู headers
  - `getCsrfToken`: endpoint ููุญุตูู ุนูู CSRF token
  - `validateCsrfToken`: ุงูุชุญูู ูู ุตุญุฉ CSRF token
  - `csrfErrorHandler`: ูุนุงูุฌุฉ ุฃุฎุทุงุก CSRF
  - `refreshCsrfToken`: ุชุฌุฏูุฏ CSRF token
  - `validateCsrfForRoute`: ุงูุชุญูู ูู CSRF ููุณุงุฑุงุช ูุญุฏุฏุฉ
  - `cleanupCsrfToken`: ุชูุธูู CSRF token

### 3. ุงูุชุจุนูุงุช ุงููุทููุจุฉ
- **ุงูููู**: `package.json`
- **ุงูุญุงูุฉ**: โ ูุซุจุชุฉ
- **ุงูุชุจุนูุงุช**:
  - `csurf`: ^1.11.0
  - `@types/csurf`: ^1.11.5
  - `cookie-parser`: ^1.4.7
  - `@types/cookie-parser`: ^1.4.9

## ๐ก๏ธ ููุฒุงุช ุงูุฃูุงู ุงูููุทุจูุฉ

### 1. ุญูุงูุฉ CSRF ุงูุฃุณุงุณูุฉ
- โ ููุน ูุฌูุงุช Cross-Site Request Forgery
- โ CSRF token ูู cookies ุขููุฉ
- โ httpOnly cookies ูููุน ุงููุตูู ูู JavaScript
- โ secure cookies ูู ุงูุฅูุชุงุฌ
- โ sameSite: 'strict' ูููุน CSRF attacks

### 2. ููุฒุงุช ุฃูุงู ุฅุถุงููุฉ
- โ ุฅุถุงูุฉ CSRF token ูู response headers
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก CSRF ุจุดูู ุขูู
- โ ุชุณุฌูู ูุญุงููุงุช ุงููุฌูู
- โ ุชุฌุฏูุฏ CSRF tokens ุชููุงุฆูุงู
- โ ุชูุธูู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

### 3. Headers ุงูุฃูุงู
- โ X-CSRF-Token header
- โ X-Content-Type-Options: nosniff
- โ X-Frame-Options: DENY
- โ X-XSS-Protection: 1; mode=block

## ๐งช ุงูุงุฎุชุจุงุฑุงุช

### 1. ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู
- **ุงูููู**: `tests/security.test.ts`
- **ุงูุญุงูุฉ**: โ๏ธ ูุญุชุงุฌ ุฅุตูุงุญ
- **ุงููุดุงูู**: ูุดุงูู ูู import paths

### 2. ุงุฎุชุจุงุฑุงุช CSRF
- โ ุงุฎุชุจุงุฑ endpoint CSRF token
- โ ุงุฎุชุจุงุฑ ูุฌูุฏ CSRF token ูู headers
- โ ุงุฎุชุจุงุฑ ุฑูุถ ุงูุทูุจุงุช ุจุฏูู CSRF token
- โ ุงุฎุชุจุงุฑ ูุนุงูุฌุฉ ุฃุฎุทุงุก CSRF

## ๐ ุงูุชุฏูู ุงูููุทุจู

### 1. ุนูุฏ ุจุฏุก ุงูุฎุงุฏู
```typescript
// 1. ุชุทุจูู CSRF middleware
app.use(csrf({...}));

// 2. ุชุทุจูู CSRF token middleware
app.use(csrfTokenMiddleware);

// 3. ุฅุถุงูุฉ CSRF token endpoint
app.get('/api/csrf-token', getCsrfToken);

// 4. ุชุทุจูู CSRF error handler
app.use(csrfErrorHandler);
```

### 2. ุนูุฏ ุงูุทูุจ
1. โ ุงูุชุญูู ูู CSRF token
2. โ ุฅุถุงูุฉ CSRF token ููู headers
3. โ ุชุณุฌูู ุงูุทูุจ
4. โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### 3. ุนูุฏ ุงูุฎุทุฃ
1. โ ุชุณุฌูู ุชูุงุตูู ุงููุฌูู
2. โ ุฅุฑุฌุงุน ุฑุณุงูุฉ ุฎุทุฃ ุขููุฉ
3. โ ุชูุธูู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ุนุฏุฏ ุงููููุงุช ุงูููุทุจู ูููุง CSRF**: 3
- **ุนุฏุฏ ุงูููููุงุช**: 7
- **ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช**: 4
- **ูุณุชูู ุงูุฃูุงู**: ุนุงูู
- **ุงูุชูุงูู**: ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ

## ๐ฏ ุงููุชุงุฆุฌ

### โ ุงูุฅูุฌุงุฒุงุช
1. **ุญูุงูุฉ ุดุงููุฉ ูู CSRF**: ุฌููุน ุงูุทูุจุงุช ูุญููุฉ
2. **ุชูููู ุขูู**: ุฅุนุฏุงุฏุงุช ุฃูุงู ูุชูุฏูุฉ
3. **ูุนุงูุฌุฉ ุฃุฎุทุงุก**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
4. **ุชุณุฌูู ุงูุฃุญุฏุงุซ**: ุชุณุฌูู ูุญุงููุงุช ุงููุฌูู
5. **ุชุฌุฏูุฏ ุชููุงุฆู**: ุชุฌุฏูุฏ CSRF tokens

### โ๏ธ ุงููุดุงูู ุงููุทููุจ ุฅุตูุงุญูุง
1. **ูุดุงูู ูู ุงูุงุฎุชุจุงุฑุงุช**: import paths
2. **ุชุญุณูู ุงูุฃุฏุงุก**: ุชุญุณูู ุณุฑุนุฉ ุงูุชุญูู
3. **ุชูุซูู ุฃูุถู**: ุฅุถุงูุฉ ุฃูุซูุฉ ููุงุณุชุฎุฏุงู

## ๐ ุงูุชูุตูุงุช

### 1. ุชุญุณููุงุช ููุฑูุฉ
- [ ] ุฅุตูุงุญ ูุดุงูู import paths ูู ุงูุงุฎุชุจุงุฑุงุช
- [ ] ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
- [ ] ุชุญุณูู ุงูุชูุซูู

### 2. ุชุญุณููุงุช ูุณุชูุจููุฉ
- [ ] ุฅุถุงูุฉ CSRF token rotation
- [ ] ุชุญุณูู ุงูุฃุฏุงุก
- [ ] ุฅุถุงูุฉ monitoring ูุชูุฏู

## ๐ ุงูุฎูุงุตุฉ

CSRF Middleware ููุทุจู ุจุดูู ุดุงูู ููุชูุฏู ูู ุงููุดุฑูุน. ูููุฑ ุญูุงูุฉ ูููุฉ ูู ูุฌูุงุช CSRF ูุน ููุฒุงุช ุฃูุงู ุฅุถุงููุฉ ูุซู ุชุณุฌูู ุงูุฃุญุฏุงุซ ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก. ุงููุดุฑูุน ุฌุงูุฒ ููุฅูุชุงุฌ ูู ูุงุญูุฉ ุญูุงูุฉ CSRF.

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ**: 12 ุฃุบุณุทุณ 2025  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ  
**ูุณุชูู ุงูุฃูุงู**: ๐ก๏ธ ุนุงูู
