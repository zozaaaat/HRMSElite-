# تنفيذ نظام الإجازات والحضور - HRMS Elite

## الميزات المضافة

### 1. صفحة إدارة الإجازات (`pages/leaves.tsx`)

#### الميزات الرئيسية:
- **إدارة طلبات الإجازات**: عرض جميع طلبات الإجازات مع إمكانية الموافقة أو الرفض
- **ربط الإجازات بالحالات**: 
  - `pending` - قيد المراجعة
  - `approved` - موافق عليها
  - `rejected` - مرفوضة
- **تقارير الحضور والغياب**: عرض تفاصيل حضور الموظفين مع أسباب الغياب
- **التقارير المتقدمة**: إحصائيات شهرية وتحليلات مفصلة
- **تقويم الإجازات**: عرض الإجازات على التقويم الشهري

#### الواجهات:
```typescript
interface LeaveRequest {
  id: string;
  employeeName: string;
  employeeId: string;
  leaveType: string;
  startDate: string;
  endDate: string;
  days: number;
  reason: string;
  status: 'pending' | 'approved' | 'rejected';
  appliedDate: string;
  approvedBy?: string;
  approvedDate?: string;
  rejectionReason?: string;
}
```

### 2. نموذج طلب الإجازة (`components/leave-request-form.tsx`)

#### الميزات:
- **حساب تلقائي لأيام الإجازة**: يستثني أيام العطل الأسبوعية
- **التحقق من الرصيد المتاح**: يتحقق من رصيد الإجازات قبل الإرسال
- **التحقق من صحة البيانات**: 
  - التأكد من أن تاريخ النهاية بعد تاريخ البداية
  - عدم السماح بطلبات في الماضي
  - التحقق من تعبئة جميع الحقول المطلوبة
- **عرض الرصيد المتاح**: يظهر رصيد الإجازات المتاح للموظف
- **تحذيرات ذكية**: تحذير عند استنفاذ نسبة كبيرة من الرصيد

#### الواجهات:
```typescript
interface LeaveBalance {
  annual: number;
  used: number;
  remaining: number;
  sick: number;
  emergency: number;
  maternity?: number;
  paternity?: number;
  study?: number;
  unpaid?: number;
}
```

### 3. تحديث صفحة الحضور (`pages/attendance.tsx`)

#### الميزات المضافة:
- **ربط الحضور بتاريخ الموظف**: كل سجل حضور مرتبط بتاريخ محدد
- **تقارير التأخير**: عرض الموظفين المتأخرين مع عدد دقائق التأخير
- **تقارير الغياب**: عرض الموظفين الغائبين مع أسباب الغياب
- **تقارير الإجازات**: عرض الموظفين في إجازة مع نوع الإجازة
- **إحصائيات الحضور**: ملخص شامل لإحصائيات الحضور اليومية

#### التحديثات في الواجهة:
```typescript
interface AttendanceRecord {
  id: string;
  employeeName: string;
  employeeId: string;
  date: string;
  checkIn?: string;
  checkOut?: string;
  status: 'present' | 'absent' | 'late' | 'leave';
  workingHours?: string;
  overtime?: string;
  location?: string;
  lateMinutes?: number;
  absenceReason?: string;
  leaveType?: string;
}
```

## الربط بين الإجازات والحضور

### 1. ربط الإجازات بالحالات
- **pending**: طلب قيد المراجعة من المدير
- **approved**: طلب موافق عليه، يتم تحديث سجل الحضور تلقائياً
- **rejected**: طلب مرفوض مع سبب الرفض

### 2. ربط الحضور بتاريخ الموظف
- كل سجل حضور مرتبط بتاريخ محدد
- يمكن تتبع حضور الموظف عبر الزمن
- ربط الإجازات بسجلات الحضور

### 3. تقارير متكاملة
- **تقرير التأخير**: الموظفين المتأخرين مع تفاصيل التأخير
- **تقرير الغياب**: الموظفين الغائبين مع أسباب الغياب
- **تقرير الإجازات**: الموظفين في إجازة مع نوع الإجازة
- **إحصائيات الحضور**: ملخص شامل للحضور اليومي

## API Endpoints المطلوبة

### الإجازات:
```typescript
// جلب طلبات الإجازات
GET /api/leaves

// إرسال طلب إجازة جديد
POST /api/leaves

// الموافقة على طلب إجازة
PUT /api/leaves/{id}/approve

// رفض طلب إجازة
PUT /api/leaves/{id}/reject

// جلب إحصائيات الإجازات
GET /api/leaves/stats

// جلب رصيد الإجازات للموظف
GET /api/leave-balance
```

### الحضور:
```typescript
// جلب سجلات الحضور
GET /api/attendance

// تسجيل حضور
POST /api/attendance/checkin

// تسجيل انصراف
POST /api/attendance/checkout

// جلب تقارير الحضور
GET /api/attendance/reports

// جلب إحصائيات الحضور اليوم
GET /api/attendance/today
```

## الميزات المتقدمة

### 1. حساب أيام الإجازة
- يستثني أيام العطل الأسبوعية تلقائياً
- يحسب الأيام الفعلية فقط
- يدعم الإجازات الطويلة

### 2. التحقق من الرصيد
- يتحقق من الرصيد المتاح قبل الإرسال
- يحذر عند استنفاذ نسبة كبيرة من الرصيد
- يدعم أنواع مختلفة من الإجازات

### 3. تقارير مفصلة
- تقارير التأخير مع عدد الدقائق
- تقارير الغياب مع الأسباب
- تقارير الإجازات مع الأنواع
- إحصائيات شاملة للحضور

### 4. واجهة مستخدم متقدمة
- تصميم متجاوب
- رسائل خطأ واضحة
- تحذيرات ذكية
- عرض المعلومات بشكل منظم

## الاستخدام

### 1. طلب إجازة جديدة:
```typescript
// استخدام مكون نموذج طلب الإجازة
<LeaveRequestForm 
  employeeId="emp001"
  employeeName="أحمد محمد علي"
  leaveBalance={leaveBalance}
  onSuccess={() => {
    // إعادة تحميل البيانات
  }}
/>
```

### 2. عرض طلبات الإجازات:
```typescript
// في صفحة الإجازات
const { data: leaveRequests } = useQuery({
  queryKey: ["/api/leaves"],
});
```

### 3. عرض تقارير الحضور:
```typescript
// في صفحة الحضور
const { data: attendanceReports } = useQuery({
  queryKey: ["/api/attendance/reports"],
});
```

## التطوير المستقبلي

### 1. ميزات إضافية:
- إشعارات فورية للمديرين عند طلب إجازة
- تقويم تفاعلي لعرض الإجازات
- تقارير PDF قابلة للطباعة
- إشعارات SMS/Email

### 2. تحسينات:
- دعم الإجازات الجزئية (نصف يوم)
- دعم الإجازات المرنة
- ربط مع نظام الرواتب
- دعم الإجازات الجماعية

### 3. الأمان:
- التحقق من الصلاحيات
- تسجيل جميع العمليات
- حماية البيانات الحساسة
- النسخ الاحتياطية التلقائية 