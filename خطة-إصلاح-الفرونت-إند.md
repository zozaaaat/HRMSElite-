# خطة إصلاح الفرونت إند - HRMS Elite

## 🎯 الأهداف العامة

1. **تحسين الأداء**: تقليل وقت التحميل من 5 ثواني إلى أقل من ثانية واحدة
2. **تنظيم الكود**: تقليل عدد الملفات من 50+ إلى 30-35 ملف
3. **إصلاح الوظائف**: تفعيل جميع المكونات المعطلة
4. **تحسين التجربة**: تحسين UX/UI

---

## 📅 الجدول الزمني

### الأسبوع الأول: التنظيف والتنظيم
### الأسبوع الثاني: الإصلاح والتفعيل
### الأسبوع الثالث: التحسين والاختبار

---

## 🔧 المرحلة الأولى: التنظيف (الأسبوع الأول)

### اليوم 1-2: حذف المكونات المكررة وغير المستخدمة

#### الملفات المراد حذفها:
```bash
# حذف الملفات المكررة
rm client/src/components/employee-360-view.tsx
rm client/src/components/mobile-app-integration.tsx

# حذف الملفات غير المستخدمة
rm client/src/components/advanced-company-card.tsx
rm client/src/components/employee-archiving.tsx
rm client/src/components/notification-center.tsx
```

#### الملفات المراد دمجها:
```bash
# دمج المكونات المتشابهة
# employee-360.tsx + employee-360-view.tsx → employee-360-view.tsx
# mobile-app.tsx + mobile-app-integration.tsx → mobile-app.tsx
```

### اليوم 3-4: توحيد التوجيه

#### إنشاء ملف التوجيه الموحد:
```typescript
// client/src/lib/routes.ts
export const routes = {
  dashboard: {
    super_admin: '/dashboard/super-admin',
    company_manager: '/dashboard/company-manager',
    employee: '/dashboard/employee',
    supervisor: '/dashboard/supervisor',
    worker: '/dashboard/worker'
  },
  companies: '/companies',
  employees: '/employees',
  reports: '/reports',
  settings: '/settings',
  attendance: '/attendance',
  leave_requests: '/leave-requests',
  payroll: '/payroll',
  documents: '/documents',
  training: '/training',
  recruitment: '/recruitment',
  performance: '/performance',
  advanced_search: '/advanced-search'
};

export const getDashboardRoute = (role: string) => {
  return routes.dashboard[role as keyof typeof routes.dashboard] || routes.dashboard.worker;
};
```

#### تحديث App.tsx:
```typescript
// client/src/App.tsx
import { routes } from './lib/routes';

function Router() {
  return (
    <Switch>
      {/* Public routes */}
      <Route path="/" component={CompanySelection} />
      <Route path="/login" component={Login} />
      
      {/* Dashboard routes */}
      <Route path="/dashboard/:role" component={RoleBasedDashboard} />
      
      {/* Functional routes */}
      <Route path="/companies" component={Companies} />
      <Route path="/employees" component={Employees} />
      <Route path="/reports" component={Reports} />
      <Route path="/settings" component={SettingsPage} />
      <Route path="/attendance" component={AttendancePage} />
      <Route path="/leave-requests" component={LeaveRequestsPage} />
      <Route path="/payroll" component={PayrollPage} />
      <Route path="/documents" component={DocumentsPage} />
      <Route path="/training" component={TrainingPage} />
      <Route path="/recruitment" component={RecruitmentPage} />
      <Route path="/performance" component={PerformancePage} />
      <Route path="/advanced-search" component={AdvancedSearchPage} />
      
      {/* 404 page */}
      <Route component={NotFound} />
    </Switch>
  );
}
```

### اليوم 5-7: إعادة تنظيم Sidebar

#### إنشاء مكون Sidebar محسن:
```typescript
// client/src/components/sidebar/index.tsx
import { useNavigation } from './useNavigation';
import { navigationConfig } from './navigationConfig';
import { SidebarHeader } from './SidebarHeader';
import { SidebarMenu } from './SidebarMenu';
import { SidebarFooter } from './SidebarFooter';

export function Sidebar({ company, user, activeView }: SidebarProps) {
  const { handleNavigation } = useNavigation();
  const menuItems = navigationConfig.getMenuItems(user?.role);
  const advancedFeatures = navigationConfig.getAdvancedFeatures(user?.role);

  return (
    <div className="w-64 bg-card shadow-lg border-l border-border">
      <SidebarHeader company={company} user={user} />
      <SidebarMenu 
        items={menuItems}
        activeView={activeView}
        onNavigation={handleNavigation}
      />
      <SidebarFooter 
        features={advancedFeatures}
        onFeatureClick={handleNavigation}
      />
    </div>
  );
}
```

#### إنشاء منطق التوجيه المنفصل:
```typescript
// client/src/components/sidebar/useNavigation.ts
import { useLocation } from 'wouter';
import { routes, getDashboardRoute } from '@/lib/routes';

export const useNavigation = () => {
  const [, setLocation] = useLocation();

  const handleNavigation = (view: string) => {
    const userRole = localStorage.getItem('userRole') || 'worker';
    
    switch (view) {
      case 'dashboard':
        setLocation(getDashboardRoute(userRole));
        break;
      case 'companies':
        setLocation(routes.companies);
        break;
      case 'employees':
        setLocation(routes.employees);
        break;
      // ... باقي الحالات
      default:
        console.warn(`Unknown navigation: ${view}`);
    }
  };

  return { handleNavigation };
};
```

---

## 🔧 المرحلة الثانية: الإصلاح (الأسبوع الثاني)

### اليوم 1-3: ربط المكونات بـ API

#### إنشاء hooks للبيانات:
```typescript
// client/src/hooks/useCompanyStats.ts
import { useQuery } from '@tanstack/react-query';

export const useCompanyStats = (companyId: string) => {
  return useQuery({
    queryKey: ['company-stats', companyId],
    queryFn: () => fetchCompanyStats(companyId),
    staleTime: 5 * 60 * 1000, // 5 minutes
    enabled: !!companyId
  });
};

// client/src/hooks/useMobileAppStats.ts
export const useMobileAppStats = () => {
  return useQuery({
    queryKey: ['mobile-app-stats'],
    queryFn: fetchMobileAppStats,
    staleTime: 10 * 60 * 1000, // 10 minutes
  });
};

// client/src/hooks/useEmployee360.ts
export const useEmployee360 = (employeeId: string) => {
  return useQuery({
    queryKey: ['employee-360', employeeId],
    queryFn: () => fetchEmployee360Data(employeeId),
    staleTime: 2 * 60 * 1000, // 2 minutes
    enabled: !!employeeId
  });
};
```

#### تحديث المكونات لاستخدام البيانات الحقيقية:
```typescript
// client/src/components/mobile-app.tsx
import { useMobileAppStats } from '@/hooks/useMobileAppStats';
import { LoadingSpinner } from '@/components/ui/loading-spinner';
import { ErrorMessage } from '@/components/ui/error-message';

export function MobileApp() {
  const { data: stats, isLoading, error } = useMobileAppStats();

  if (isLoading) return <LoadingSpinner />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Smartphone className="h-5 w-5" />
          التطبيق المحمول
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="text-center">
            <div className="text-2xl font-bold text-blue-600">
              {stats?.downloads || 0}
            </div>
            <div className="text-sm text-gray-500">تحميل التطبيق</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-green-600">
              {stats?.activeUsers || 0}
            </div>
            <div className="text-sm text-gray-500">مستخدم نشط</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

### اليوم 4-5: إضافة إدارة حقيقية للحالة

#### إنشاء store باستخدام Zustand:
```typescript
// client/src/store/useAppStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AppState {
  user: User | null;
  company: Company | null;
  theme: 'light' | 'dark';
  setUser: (user: User | null) => void;
  setCompany: (company: Company | null) => void;
  setTheme: (theme: 'light' | 'dark') => void;
  logout: () => void;
}

export const useAppStore = create<AppState>()(
  persist(
    (set) => ({
      user: null,
      company: null,
      theme: 'light',
      setUser: (user) => set({ user }),
      setCompany: (company) => set({ company }),
      setTheme: (theme) => set({ theme }),
      logout: () => set({ user: null, company: null })
    }),
    {
      name: 'hrms-store',
      partialize: (state) => ({ 
        user: state.user, 
        company: state.company, 
        theme: state.theme 
      })
    }
  )
);
```

#### تحديث SharedLayout:
```typescript
// client/src/components/shared-layout.tsx
import { useAppStore } from '@/store/useAppStore';

export function SharedLayout({ children }: SharedLayoutProps) {
  const { user, company } = useAppStore();

  if (!user || !company) {
    return <Navigate to="/login" />;
  }

  return (
    <div className="flex h-screen bg-background">
      <Sidebar 
        user={user} 
        company={company}
        activeView="dashboard"
        onViewChange={() => {}}
      />
      <main className="flex-1 overflow-auto">
        {children}
      </main>
    </div>
  );
}
```

### اليوم 6-7: تفعيل المكونات المعطلة

#### تفعيل AI Assistant:
```typescript
// client/src/components/ai-assistant.tsx
import { useAIAssistant } from '@/hooks/useAIAssistant';

export function AIAssistant() {
  const { messages, sendMessage, isLoading } = useAIAssistant();

  return (
    <Card className="h-full">
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Bot className="h-5 w-5" />
          المساعد الذكي
        </CardTitle>
      </CardHeader>
      <CardContent className="flex flex-col h-[400px]">
        <ScrollArea className="flex-1 mb-4">
          <div className="space-y-4">
            {messages.map((message) => (
              <MessageBubble key={message.id} message={message} />
            ))}
          </div>
        </ScrollArea>
        
        <MessageInput onSend={sendMessage} isLoading={isLoading} />
      </CardContent>
    </Card>
  );
}
```

#### تفعيل Workflow Builder:
```typescript
// client/src/components/workflow-builder.tsx
import { useWorkflowBuilder } from '@/hooks/useWorkflowBuilder';

export function WorkflowBuilder() {
  const { workflows, createWorkflow, updateWorkflow, deleteWorkflow } = useWorkflowBuilder();

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Settings className="h-5 w-5" />
          منشئ سير العمل
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-semibold">سير العمل الحالي</h3>
            <Button size="sm" onClick={() => createWorkflow()}>
              <Plus className="h-4 w-4 ml-2" />
              إضافة خطوة
            </Button>
          </div>
          
          <WorkflowList 
            workflows={workflows}
            onUpdate={updateWorkflow}
            onDelete={deleteWorkflow}
          />
        </div>
      </CardContent>
    </Card>
  );
}
```

---

## 🔧 المرحلة الثالثة: التحسين (الأسبوع الثالث)

### اليوم 1-2: تحسين الأداء

#### إضافة React.memo:
```typescript
// client/src/components/company-card.tsx
import React from 'react';

export const CompanyCard = React.memo(({ company, onClick }: CompanyCardProps) => {
  return (
    <Card onClick={onClick} className="cursor-pointer hover:shadow-lg transition-shadow">
      {/* ... */}
    </Card>
  );
});

CompanyCard.displayName = 'CompanyCard';
```

#### إضافة Lazy Loading:
```typescript
// client/src/App.tsx
import { lazy, Suspense } from 'react';

const Companies = lazy(() => import('./pages/companies'));
const Employees = lazy(() => import('./pages/employees'));
const Reports = lazy(() => import('./pages/reports'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Router />
    </Suspense>
  );
}
```

### اليوم 3-4: إضافة اختبارات

#### إنشاء اختبارات الوحدة:
```typescript
// client/src/components/__tests__/company-card.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { CompanyCard } from '../company-card';

describe('CompanyCard', () => {
  const mockCompany = {
    id: '1',
    name: 'شركة تجريبية',
    description: 'وصف الشركة',
    status: 'active'
  };

  it('should render company information', () => {
    render(<CompanyCard company={mockCompany} />);
    expect(screen.getByText(mockCompany.name)).toBeInTheDocument();
    expect(screen.getByText(mockCompany.description)).toBeInTheDocument();
  });

  it('should call onClick when clicked', () => {
    const mockOnClick = jest.fn();
    render(<CompanyCard company={mockCompany} onClick={mockOnClick} />);
    
    fireEvent.click(screen.getByRole('button'));
    expect(mockOnClick).toHaveBeenCalledWith(mockCompany.id);
  });
});
```

### اليوم 5-7: تحسين UX/UI

#### إضافة Loading States:
```typescript
// client/src/components/ui/loading-spinner.tsx
export function LoadingSpinner({ size = 'md' }: { size?: 'sm' | 'md' | 'lg' }) {
  const sizeClasses = {
    sm: 'h-4 w-4',
    md: 'h-8 w-8',
    lg: 'h-12 w-12'
  };

  return (
    <div className="flex items-center justify-center p-4">
      <div className={`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${sizeClasses[size]}`} />
    </div>
  );
}
```

#### إضافة Error Boundaries:
```typescript
// client/src/components/error-boundary.tsx
import React from 'react';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<
  React.PropsWithChildren<{}>,
  ErrorBoundaryState
> {
  constructor(props: React.PropsWithChildren<{}>) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="flex items-center justify-center min-h-screen">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-red-600 mb-4">
              حدث خطأ غير متوقع
            </h2>
            <p className="text-gray-600 mb-4">
              يرجى تحديث الصفحة أو المحاولة مرة أخرى
            </p>
            <button
              onClick={() => window.location.reload()}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              تحديث الصفحة
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

---

## 📊 مقاييس النجاح

### الأداء:
- [ ] وقت التحميل الأولي < 1 ثانية
- [ ] وقت التحميل بين الصفحات < 500ms
- [ ] حجم الحزمة < 1MB

### الكود:
- [ ] عدد الملفات < 35
- [ ] تغطية الاختبارات > 80%
- [ ] عدم وجود أخطاء TypeScript

### الوظائف:
- [ ] جميع المكونات تعمل بشكل صحيح
- [ ] ربط جميع البيانات بـ API
- [ ] إدارة الحالة تعمل بشكل صحيح

### التجربة:
- [ ] تحسين UX/UI
- [ ] إضافة Loading States
- [ ] معالجة الأخطاء بشكل صحيح

---

## 🚀 خطوات التنفيذ

### الأسبوع الأول:
1. **اليوم 1-2**: حذف المكونات المكررة
2. **اليوم 3-4**: توحيد التوجيه
3. **اليوم 5-7**: إعادة تنظيم Sidebar

### الأسبوع الثاني:
1. **اليوم 1-3**: ربط المكونات بـ API
2. **اليوم 4-5**: إضافة إدارة الحالة
3. **اليوم 6-7**: تفعيل المكونات المعطلة

### الأسبوع الثالث:
1. **اليوم 1-2**: تحسين الأداء
2. **اليوم 3-4**: إضافة اختبارات
3. **اليوم 5-7**: تحسين UX/UI

---

## 📝 ملاحظات مهمة

1. **النسخ الاحتياطي**: تأكد من عمل نسخة احتياطية قبل البدء
2. **التدرج**: نفذ التغييرات تدريجياً واختبر كل مرحلة
3. **التوثيق**: وثق جميع التغييرات
4. **الاختبار**: اختبر على متصفحات مختلفة
5. **الأداء**: راقب الأداء بعد كل تغيير

---

*تم إنشاء هذه الخطة في: ${new Date().toLocaleDateString('ar-SA')}*
*آخر تحديث: ${new Date().toLocaleDateString('ar-SA')}* 